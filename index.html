<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>A11Y Filter Table</title>
    <style>

		/* BEGIN page level styles */
		body { background-color:#FBFCFC; color:#1C2833; font-size:2rem;;  } 
    	#content { width:90%; margin:auto; } 
		h1 { font-size:3rem; }
		/* END page level styles */

	    /* BEGIN Input Form */
		#inputFormContainer label { width:10%; display:inline-block;text-align:right; margin:auto 5px; font-weight:bold; }
		#inputFormContainer input { border-radius:5px; height:40px; width:300px; margin:10px auto; }
		#inputFormContainer input[type="submit"]{ border-radius:5px; font-size:2rem; margin:20px auto; padding:10px; height:75px; font-weight:bold; border:2px solid #000;  }
	    /* END Input Form */
  
		/* BEGIN Table */
    	table, th, td { border-collapse: collapse; border:2px solid #000; padding:10px; text-align:left; vertical-align:top; } 
		/* END Table */

        /* BEGIN Sort Controls */ 
        #sortButtons label { margin-left:5px; font-size:1.8rem; }  
		.offscreenText {
			position: absolute;
			clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
			clip: rect(1px, 1px, 1px, 1px);
			clip-path: inset(50%);
			padding: 0;
			border: 0;
			height: 1px; 
			width: 1px; 
			overflow: hidden;
			white-space: nowrap;
		}
		
		.sortRadio { border:1px solid #000; display:inline-block; padding:10px; margin:10px 10px;  border-radius:5px; } 
        #sortButton { font-weight:bold; font-size:3rem; display:block; border-radius:10px; margin:10px 10px; border:3px solid #000; width:10%; } 
		input[type="radio"] { height:2rem; width:2rem; display:inline-block;  } 
		#status { border:1px solid #000; width:20%; padding:20px; border-radius:5px;  } 

		/* END Sort Controls */ 



    </style>
  </head>
  <body>

    <section id="content">
		<h1>Filter Table</h1>

		<h2>Input Form</h2>
		<div id="inputFormContainer"></div>

		<h2>Column Sorting Controls</h2>
		<div id="sortButtons"></div>

		<h2>Table</h2>
		<section id="tableContainer"></section>

    </section>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script>

		function getData(){
			let url = './getTableJSON.php';
			let jsonObjectsArray = [];
			$.ajax({
			  type: 'GET',
			  url: url,
			  dataType: 'json',
			  success: function(data) { jsonObjectsArray = data;},
			  async: false
			});

			return jsonObjectsArray;

		}

   		function getDataForSort(orderBy){
			let url = './getTableJSON.php?orderby=' + orderBy;
			let jsonObjectsArray = [];
			$.ajax({
			  type: "GET",
			  url: url,
			  dataType: 'json',
			  success: function(data) { jsonObjectsArray = data;},
			  async: false
			});

			return jsonObjectsArray;

		}
	    function init(){
			let jsonObjectsArray = getData(); 
			createInputForm(jsonObjectsArray); 
		    createSortControls(jsonObjectsArray);  
			createTable(jsonObjectsArray);
		}

	    function sort(e){
			let sortColumn, sortDirection;
			let orderBy = '';
         
			let checkedCnt = 0;  
            $("#sortButtons input[type=radio]:checked").each(function() {    checkedCnt++; 
				sortColumn  = $(this).attr('data-sortcolumn'); 
				sortDirection = $(this).attr('data-sortdirection');
				orderBy += ' ' +  sortColumn + ' ' + sortDirection;
				
            });
            $('#status').text('now sorting by' + orderBy); 
        	let jsonObjectsArray = getDataForSort(orderBy); 
			createTable(jsonObjectsArray);
		} 

		function createInputForm(jsonObjectsArray) {
			let inputForm = '';	
			inputForm += '<form action="./insert.php" method="post">';
			
			for (let key in jsonObjectsArray[0]) {
					let id = key + '_input';
					inputForm += '<div>';
					if(key !== 'id'){
						inputForm += '<label for="' + id + '"' + '>';
						inputForm += key + ':';
						inputForm += '</label>';
					}
					if(key === 'id'){
						inputForm += '<input type="hidden" value="NULL"  id="' + id + '"' + ' name="' + key + '"' + '/>';
					} else {
						inputForm += '<input id="' + id + '"' + ' name="' + key + '"' + '/>';
					} 
					inputForm += '</div>';

			} 
            inputForm += '<input type="submit" value="Submit">'; 
			inputForm += '</form>';
			$('#inputFormContainer').html(inputForm);
		} 

		function createSortControls(jsonObjectsArray) {
			let	sortButtonsHtmlString = ''; 
			let tableHtmlString;
			let radioName = "sort";
		           
			sortButtonsHtmlString += '<div role="radiogroup" aria-label="sorting choices">';
			for (let key in jsonObjectsArray[0]) {

				//sort ascending radio buttons
				sortButtonsHtmlString += '<div class="sortRadio">';
				sortButtonsHtmlString += '<input type="radio" name="' + radioName + '" ' + 'data-sortcolumn="' + key + '" '  + 'data-sortdirection="ASC"' + ' id="' + key + '_ascending">';
				sortButtonsHtmlString += '<label for="' + key + '_ascending">';
				sortButtonsHtmlString += key; 
				sortButtonsHtmlString += '<span class="offscreenText">'; 
				sortButtonsHtmlString += 'sort'; 
				sortButtonsHtmlString += ' ascending'; 
				sortButtonsHtmlString += '</span>'; 
				sortButtonsHtmlString += '<span class="sortArrow" aria-hidden="true">'; 
				sortButtonsHtmlString += '&uarr;'; 
				sortButtonsHtmlString += '</span>'; 
				sortButtonsHtmlString += '</label>';
				sortButtonsHtmlString += '</div>';

				//sort descending radio buttons
				sortButtonsHtmlString += '<div class="sortRadio">';
				sortButtonsHtmlString += '<input type="radio" name="' + radioName + '" ' + 'data-sortcolumn="' + key + '" '  + 'data-sortdirection="DESC"' + ' id="' + key + '_descending">';
				sortButtonsHtmlString += '<label for="' + key + '_descending">';
				sortButtonsHtmlString += key; 
				sortButtonsHtmlString += '<span class="offscreenText">'; 
				sortButtonsHtmlString += 'sort'; 
				sortButtonsHtmlString += ' descending'; 
				sortButtonsHtmlString += '</span>'; 
				sortButtonsHtmlString += '<span class="sortArrow" aria-hidden="true">'; 
				sortButtonsHtmlString += '&darr;'; 
				sortButtonsHtmlString += '</span>'; 
				sortButtonsHtmlString += '</label>'; 
				sortButtonsHtmlString += '</div>';

			}

			sortButtonsHtmlString += '</div>';
			sortButtonsHtmlString += '<h3>Sort Status</h3>';
			sortButtonsHtmlString += '<div id="status" aria-live="polite"></div>';
		    	

			$('#sortButtons').html(sortButtonsHtmlString);

            $('#status').text('now sorting by id descending'); 
			$('#sortButtons input[type="radio"]').click((e)=>{sort(e)});


		}

 
    	function createTable(jsonObjectsArray){

            tableHtmlString = '<table>';
			tableHtmlString += '<tr>';
			for (let key in jsonObjectsArray[0]) {
				tableHtmlString += '<th>';
				tableHtmlString += key; 
				tableHtmlString += '</th>';
			}
			tableHtmlString += '</tr>';

			for(let i = 0; i < jsonObjectsArray.length; i++) {
				tableHtmlString += '<tr>';		
				for (let key in jsonObjectsArray[i]) {
					tableHtmlString += '<td>';		
					tableHtmlString += jsonObjectsArray[i][key];		
					tableHtmlString += '</td>';		
				}		
				tableHtmlString += '</tr>';		
			}

			tableHtmlString += "</table>";

			$('#tableContainer').html(tableHtmlString);

		}
		
		init();  

	</script>

  </body>
</html>

